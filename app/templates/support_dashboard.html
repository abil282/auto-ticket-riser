<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Support Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark"><div class="container"><a class="navbar-brand" href="#">Support</a><div class="ms-auto"><a class="btn btn-outline-light" href="/support/logout">Logout</a></div></div></nav>
<div class="container my-4">
    <h3>Your Assigned Tickets</h3>
    <div id="ticketsContainer" class="mt-3"></div>
</div>
<script>
async function loadAssigned(){
    try{
        const res = await fetch('/support/api/tickets');
        const j = await res.json();
        const container = document.getElementById('ticketsContainer');
        if(!j.tickets || j.tickets.length===0){ container.innerHTML = '<div class="alert alert-info">No tickets assigned to you.</div>'; return; }
        container.innerHTML = j.tickets.map(t=>`<div class="card mb-3"><div class="card-body"><h5>#${t.ticket_id} - ${t.status}</h5><p>${t.corrected_description || t.original_description}</p><p><small>Priority: ${t.priority} | Dept: ${t.department}</small></p><button class="btn btn-sm btn-primary" onclick="openEditor('${t.ticket_id}')">Open</button></div></div>`).join('');
    }catch(e){ console.error(e); }
}
function openEditor(id){ window.location.href = '/admin/?ticket='+encodeURIComponent(id); }
loadAssigned();
</script>
</body>
</html>